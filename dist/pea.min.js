/*!
 * pea-js 0.3.0
 * Pea is a middleware layer for web, inspired by the connect
 * Copyright 2017, ccbabi <kxxw28@gmail.com>
 * Released under the MIT license.
*/

!function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():t.Pea=n()}(this,function(){"use strict";function t(t){var n=i.toString.call(t).match(/\((\w+)/);return!!n&&r.indexOf(n[1])>-1}var n=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),e=Array.prototype,i=Function.prototype,r=["e","err","error"];return function(){function i(t){var n=this;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,i),this.stack=[],this.head=0,this.tail=0,t&&t instanceof Array&&t.forEach(function(t){return n.use(t)})}return n(i,[{key:"use",value:function(t){var n=void 0;return n=t instanceof i?function(){var n=e.pop.apply(arguments);t.use(function(){e.pop.apply(arguments),n.apply(this,arguments)}),t.use(function(t,e){t&&n(t)}),t.start.apply(t,arguments)}.bind(this):t,this.tail=this.stack.push(n),this}},{key:"start",value:function(){this.head=0,this.next.apply(this,arguments)}},{key:"next",value:function(t){this.run.apply(this,arguments)}},{key:"run",value:function(){var n=void 0,i=void 0,r=e.slice.apply(arguments),a=r[0];if(a instanceof Error&&(i=a),this.head>=this.tail){if(i)throw i}else{for(;!i&&r.length&&void 0==a;)r.shift(),a=r[0];if(n=this.stack[this.head++],i&&t(n)||!i&&!t(n)){r.push(this.next.bind(this));try{return void n.apply(this,r)}catch(t){i=t}}this.next(i)}}}]),i}()});